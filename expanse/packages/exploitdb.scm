(define-module (expanse packages exploitdb)
  #:use-module (gnu packages)
  #:use-module (guix gexp)
  #:use-module (guix packages)
  #:use-module (guix git-download)
  #:use-module (gnu packages base)
  #:use-module (gnu packages bash)
  #:use-module (gnu packages gawk)
  #:use-module (gnu packages ncurses)
  #:use-module (gnu packages node)
  #:use-module (gnu packages perl)
  #:use-module (gnu packages php)
  #:use-module (gnu packages python)
  #:use-module (gnu packages ruby)
  #:use-module (gnu packages shells)
  #:use-module (gnu packages xml)
  #:use-module (guix build-system copy)
  #:use-module ((guix licenses) #:prefix license:))

(define-public exploitdb
(let ((commit "004fdfd467d849f2422c7aebbada8776005a8158")
      (revision "1"))
  (package
    (name "exploitdb")
    (version "")
    (source
     (origin
       (method git-fetch)
       (uri (git-reference
	   (url "https://github.com/offensive-security/exploitdb")
	   (commit commit)))
       (sha256
        (base32
         "0zf7gyh6zxf9gxv3i16flck15a53mzj7i93h0shaxblm9rn0i00r"))))
    (build-system copy-build-system)
	(arguments
	(list #:phases
	 #~(modify-phases %standard-phases
	    (add-after 'install 'wrap-searchsploit
		(lambda* (#:key inputs #:allow-other-keys)
		(wrap-program (string-append #$output "/searchsploit")
		`("PATH" ":" prefix
		,(map (lambda (dir) (string-append dir "/bin"))
		(list #$(this-package-input "ncurses")
              #$(this-package-input "grep")
              #$(this-package-input "coreutils")
              #$(this-package-input "libxml2")
              #$(this-package-input "sed")
              #$(this-package-input "gawk"))))))))))
	(inputs (list bash-minimal ncurses grep coreutils libxml2 sed gawk perl
	loksh node python python-2 php ruby tcsh))
	; https://github.com/offensive-security/exploitdb/issues/225
	; Missing interpreters: 'bin' 'hybris' 'php5-cgi' 'pythion' 'suidperl' 'YahYa'
    (home-page
     "https://www.exploit-db.com/")
    (synopsis
     "Exploit Database")
    (description
     "This package provides Exploit Database.")
    (license license:gpl2+))))
